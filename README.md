# Telegram Mini App - Backend

## Руководство для разработчика (Backend)

### 1. Установка и запуск проекта локально

#### 1.1 Требования
- Python версии 3.10 или выше

#### 1.2 Клонирование репозитория
```bash
git clone https://github.com/your-username/your-backend-repo.git
cd your-backend-repo
```

#### 1.3 Настройка виртуального окружения
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
venv\Scripts\activate    # Windows
```

#### 1.4 Установка зависимостей
```bash
pip install -r requirements.txt
```

#### 1.5 Запуск сервера
```bash
uvicorn app.main:app --reload
```

После запуска перейдите на http://127.0.0.1:8000/docs для взаимодействия с API через Swagger UI.

### 2. Структура проекта

```
project/
├── app/
│   ├── __init__.py
│   ├── crud.py          # Логика взаимодействия с базой
│   ├── database.py      # Подключение к SQLite
│   ├── models.py        # SQLAlchemy-модели
│   ├── schemas.py       # Pydantic-модели
│   └── utils.py         # Вспомогательные функции
├── main.py              # Основной файл FastAPI-приложения
├── requirements.txt     # Список зависимостей
└── .gitignore          # Исключение папки venv и других временных файлов
```

### 3. База данных
Используется SQLite (удобна для разработки и демонстрации). 

#### 3.1 Инициализация базы данных
База данных создается автоматически при первом запуске приложения. Файл базы данных `test.db` будет создан в корневой директории проекта.

#### 3.2 Структура базы данных
База данных содержит следующие таблицы:
- `users` - информация о пользователях
- `likes` - записи о лайках между пользователями
- `dislikes` - записи о дизлайках между пользователями
- `matches` - записи о совпадениях между пользователями

#### 3.3 Работа с базой данных
- База данных автоматически создается при запуске `main.py`
- Все таблицы создаются через SQLAlchemy модели
- Для просмотра содержимого базы данных можно использовать SQLite Browser или любой другой SQLite клиент

#### 3.4 Резервное копирование
Рекомендуется регулярно делать резервные копии базы данных:
```bash
# Создание резервной копии
cp test.db test.db.backup

# Восстановление из резервной копии
cp test.db.backup test.db
```

#### 3.5 Важно
- Файл базы данных (`test.db`) добавлен в `.gitignore` и не будет отправлен в репозиторий
- При деплое на Render будет создана новая база данных
- Для продакшена рекомендуется использовать PostgreSQL или другую production-ready базу данных

### 4. Эндпоинты и логика работы
Подробное описание эндпоинтов доступно в Swagger UI по адресу http://127.0.0.1:8000/docs

### 5. Деплой на Render
1. Зарегистрируйтесь на https://render.com
2. Создайте новое Web Service и подключите GitHub-репозиторий
3. Укажите:
   - Start command: `uvicorn app.main:app --host 0.0.0.0 --port 10000`
   - Python Build: `pip install -r requirements.txt`
4. Убедитесь, что добавлен .gitignore, исключающий venv/
5. После деплоя Render выдаст ссылку для доступа к вашему API

## Руководство для фронтендера

### 1. Подключение к API

Фронтендеру необходимо использовать эндпоинты, доступные по URL (указан разработчиком). Примеры:

#### Получить анкету:
```http
GET https://your-backend.onrender.com/profiles/next?current_user_id=1
```

#### Лайкнуть пользователя:
```http
POST https://your-backend.onrender.com/profiles/5/like?current_user_id=1
```

#### Обновить профиль:
```http
PUT https://your-backend.onrender.com/profiles/1
Content-Type: application/json

{
  "name": "Иван",
  "age": 24,
  "car": "BMW M3",
  "about": "Люблю скорость",
  "region": "Москва"
}
```

### 2. Авторизация и идентификация пользователя
Сейчас авторизация не реализована, фронтендер должен сам передавать current_user_id в запросах. В будущем можно использовать Telegram ID или JWT токены.

### 3. Работа с Telegram WebApp
Фронтенд размещается в Telegram WebApp, а backend — это внешний API, с которым Telegram WebApp взаимодействует через fetch/axios-запросы.

### 4. Swagger-документация
Для удобства фронтендера доступна документация всех маршрутов:
https://your-backend.onrender.com/docs

### 5. Рекомендации
- Всегда указывай Content-Type: application/json
- Обрабатывай ошибки (например, "No more profiles")
- Убедись, что ID пользователя передаётся корректно во всех запросах

Если что-то непонятно — backend разработчик всегда доступен для помощи. 